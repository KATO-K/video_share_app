<div class="content">
<h1>ビデオ投稿</h1>

<%= form_with(model: @video, url:videos_path, local:true ) do |f| %>
  <%=render "users/shared/error_messages", resource:@video %>
  
  <div class="row">
    <div class="col-md-6">
      <div class="field">
        <%= f.label :video %><br>
        <%= f.file_field :video, accept: "video/*", id:"post" %>
      </div>

      <!--このclassのエリアを、file_fieldの上に被せる-->
      <div class="choice_box">ドラック＆ドロップまたはクリック</div>

      <!--ここにプレビュー表示-->
      <div id="show"></div>

    </div>
    <div class="col-md-6">
      <div class="field">
        <%= f.label :title %><br>
        <%= f.text_field :title, id: "title" %><br>
      </div>

       <div class="field">
         <%= f.label :open_period %><br>
         <%= f.datetime_field :open_period , id:"open_period" %> 
       </div>

       <div class="field">
         <%= f.label :range %><br>
         <%= f.select :range, [['一般公開',0],['限定公開',1]], { include_blank: false, selected: 0 }, id:"range" %>
       </div> 

       <div class="field">
         <%= f.label :comment_public %><br>
         <%= f.select :comment_public, [['公開',0],['非公開',1]], { include_blank: false, selected: 0 }, id:"comment_public" %>
       </div>

       <div class="field">
         <%= f.label :login_set %><br>
         <%= f.select :login_set, [['ログイン不要',0],['ログイン必要',1]], { include_blank: false, selected: 0 }, id:"login_set" %>
       </div>

       <div class="field">
         <%= f.label :popup_before_video %><br>
         <%= f.select :popup_before_video, [['動画視聴開始時ポップアップ表示',0],['動画視聴開始時ポップアップ非表示',1]], { include_blank: false, selected: 0 }, id:"popup_before_video" %>
       </div>

       <div class="field">
         <%= f.label :popup_after_video %><br>
         <%= f.select :popup_after_video, [['動画視聴終了時ポップアップ表示',0],['動画視聴終了時ポップアップ非表示',1]], { include_blank: false, selected: 0 }, id:"popup_after_video" %>
       </div>

       <!-- video_folder中間モデル作成後、folder名一覧をここに表示予定 -->

       <div class="field">
         <%= f.hidden_field :organization_id, :value => current_user.organization.id %>
         <%= f.hidden_field :user_id, :value => current_user.id %>   
       </div>

       <div class="actions">
         <%= f.submit "新規投稿" %>
       </div>
    </div>
  </div>
<% end %>
</div>

<script type="text/javascript">
$(function(){
    // もし、file_fieldに変化があれば（ファイルがアップされれば）
    $('#post').change(function(){
      // プレビューのvideoタグを削除
      $('video').remove();
      // 投稿されたファイルの1つ目をfileと置く。
      var file = $("#post").prop('files')[0];
      // 以下プレビュー表示のための記述
      var fileReader = new FileReader();
      // videoタグを生成しプレビューを表示(データのURLを出力)
      fileReader.onloadend = function() {
        $('#show').html('<video src="' + fileReader.result + '"/>');
      }
      // 読み込みを実行
      fileReader.readAsDataURL(file);
    });
  });

</script>



